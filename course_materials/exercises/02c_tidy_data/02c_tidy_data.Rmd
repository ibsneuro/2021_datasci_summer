---
title: "Tutorial: Working with tidy data / tidying data"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(DT)

knitr::opts_chunk$set(echo = FALSE)
```


## Working with tidy data

The following is based closely on [R4DS Chapter 12](https://r4ds.had.co.nz/tidy-data.html).

### Examples 

Let's start with a couple of examples to show how you can work with tidy data.

First, recall `table1`, which contains the number of TB cases documented by the WHO in Afghanistan, Brazil and China between 1999 and 2000.

Note the use of `datatable` from the `DT` package, which creates an interactive data table.

```{r table1}
datatable(table1)

```

Now create a new variable to compute the rate per 10,000 population:

```{r rate_per_10000, exercise=TRUE, exercise.eval=TRUE}

table1 %>% 
  mutate(rate = cases / population * 10000)

```

Compute cases per year:

```{r cases_per_year, exercise=TRUE, exercise.eval=TRUE}
table1 %>% 
  count(year, wt = cases)
```

Visualise changes over time:

```{r change_over_time, exercise=TRUE, exercise.eval=TRUE}
ggplot(table1, aes(year, cases)) + 
  geom_line(aes(group = country), colour = "grey50") + 
  geom_point(aes(colour = country))
```

```{r tidy_examples_quiz1}
quiz(caption = "On the basis of the examples above, answer the following questions:",
 question("Which country had the highest number of cases overall?",
    answer("Afghanistan"),
    answer("Brazil"),
    answer("China", correct=TRUE),
    allow_retry = TRUE
  ),
 
 question("Which country had the highest case rate per 10,000 people?",
    answer("Afghanistan"),
    answer("Brazil", correct=TRUE),
    answer("China"),
    allow_retry = TRUE
  )
)
```

### Exercises (from R4DS)

*1. Using prose, describe how the variables and observations are organised in each of the sample tables. (Use the code chunk below to explore them again, if you wish.)*

```{r sample_table_description, exercise=TRUE, exercise.lines = 3}

```

*2. Compute the rate for table2, and table4a + table4b. You will need to perform four operations:*

  * *Extract the number of TB cases per country per year.*
  * *Extract the matching population per country per year.*
  * *Divide cases by population, and multiply by 10000.*
  * *Store back in the appropriate place.*

  *Which representation is easiest to work with? Which is hardest? Why?*

NOTE: it is expected that you will find this difficult! Have a go and see how far you get -- we will work through the exercise together once you have tried it yourself. (Hint: don't forget that you can extract columns from a data frame using the `$` operator.)

Use this chunk to compute the rate for table2:

```{r compute_rate_table2, exercise=TRUE, exercise.lines = 5}

```

Use this chunk to compute the rate for table4:

```{r compute_rate_table4, exercise=TRUE, exercise.lines = 5}

```

*3. Recreate the plot showing change in cases over time using table2 instead of table1. What do you need to do first?*

```{r plot_from_table2, exercise=TRUE, exercise.lines = 5}

```


